{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ student.username }} | StudyPortal Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 font-sans">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-gradient-to-b from-blue-600 to-blue-800 text-white shadow-xl">
            <div class="p-6 border-b border-blue-500">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
                        <i class="fas fa-graduation-cap text-blue-600 text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold">StudyPortal</h2>
                        <p class="text-blue-200 text-xs">Admin Control Panel</p>
                    </div>
                </div>
            </div>
            
            <nav class="p-6 space-y-2">
                <a href="{% url 'admin_dashboard' %}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-blue-100 hover:bg-white/10 transition-all">
                    <i class="fas fa-chart-line w-5"></i>Dashboard
                </a>
                <a href="{% url 'admin_students' %}" class="flex items-center gap-3 px-4 py-3 rounded-xl bg-white/20 text-white border border-white/20">
                    <i class="fas fa-users w-5"></i>Students
                </a>
                <a href="{% url 'admin_courses' %}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-blue-100 hover:bg-white/10 transition-all">
                    <i class="fas fa-book w-5"></i>Courses
                </a>
                <a href="{% url 'assign_courses' %}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-blue-100 hover:bg-white/10 transition-all">
                    <i class="fas fa-tasks w-5"></i>Assign Courses
                </a>
                <a href="{% url 'student_study_tracks' %}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-blue-100 hover:bg-white/10 transition-all">
                    <i class="fas fa-list-alt w-5"></i>Study Tracks
                </a>
                <a href="{% url 'admin_analytics' %}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-blue-100 hover:bg-white/10 transition-all">
                    <i class="fas fa-chart-bar w-5"></i>Analytics
                </a>
                <a href="{% url 'admin_settings' %}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-blue-100 hover:bg-white/10 transition-all">
                    <i class="fas fa-cog w-5"></i>Settings
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8">
            <!-- Header -->
            <div class="flex justify-between items-center mb-8">
                <div class="flex items-center space-x-4">
                    <a href="{% url 'admin_students' %}" class="text-blue-600 hover:text-blue-800">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Students
                    </a>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">{{ student.username }}</h1>
                        <p class="text-gray-600">Student profile and study progress</p>
                    </div>
                </div>
                <div class="relative">
                    <button onclick="toggleProfileDropdown()" class="flex items-center space-x-3 bg-white px-4 py-2 rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition-all">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold">
                            {{ user.username|first|upper }}
                        </div>
                        <div class="text-left">
                            <p class="font-semibold text-gray-900">{{ user.username }}</p>
                            <p class="text-xs text-gray-500">Administrator</p>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                    </button>
                    <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-64 bg-white border border-gray-200 rounded-xl shadow-2xl z-50">
                        <div class="p-4 border-b">
                            <p class="font-semibold text-gray-900">{{ user.username }}</p>
                            <p class="text-sm text-gray-500">{{ user.email }}</p>
                        </div>
                        <div class="p-2">
                            <a href="#" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700">
                                <i class="fas fa-user-cog text-blue-500 w-5"></i>
                                <span>Profile Settings</span>
                            </a>
                        </div>
                        <div class="p-2 border-t">
                            <form method="post" action="{% url 'admin_logout' %}" class="w-full">{% csrf_token %}
                                <button type="submit" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-red-50 text-red-600 w-full text-left">
                                    <i class="fas fa-sign-out-alt w-5"></i>
                                    <span>Logout</span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Student Profile -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                <!-- Student Info -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Student Information</h2>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-4">
                            <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-xl">
                                {{ student.username|first|upper }}
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">{{ student.username }}</h3>
                                <p class="text-gray-600">{{ student.email }}</p>
                            </div>
                        </div>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Student ID:</span>
                                <span class="font-medium">{{ student.id }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Joined Date:</span>
                                <span class="font-medium">{{ student.date_joined|date:"M d, Y" }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Last Login:</span>
                                <span class="font-medium">{{ student.last_login|date:"M d, Y H:i"|default:"Never" }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Study Stats -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Study Statistics</h2>
                    <div class="space-y-4">
                        {% with total_courses=study_details|length total_progress=0 %}
                            {% for detail in study_details %}
                                {% widthratio detail.progress 1 1 as progress %}
                                {{ total_progress|add:progress }}
                            {% endfor %}
                            {% with avg_progress=total_progress|divisibleby:total_courses %}
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-blue-600 mb-2">
                                        {{ avg_progress|default:0 }}%
                                    </div>
                                    <p class="text-gray-600">Average Progress</p>
                                </div>
                            {% endwith %}
                        {% endwith %}
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div>
                                <div class="text-xl font-bold text-gray-900">{{ study_details|length }}</div>
                                <p class="text-sm text-gray-600">Enrolled Courses</p>
                            </div>
                            <div>
                                <div class="text-xl font-bold text-gray-900">
                                    {% with completed=0 %}
                                        {% for detail in study_details %}
                                            {% if detail.progress == 100 %}
                                                {{ completed|add:1 }}
                                            {% endif %}
                                        {% endfor %}
                                    {% endwith %}
                                </div>
                                <p class="text-sm text-gray-600">Completed</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Quick Actions</h2>
                    <div class="space-y-3">
                        <a href="{% url 'assign_courses' %}?student={{ student.id }}" 
                           class="w-full flex items-center justify-center px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all">
                            <i class="fas fa-tasks mr-2"></i>Assign Courses
                        </a>
                        <button class="w-full flex items-center justify-center px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all">
                            <i class="fas fa-envelope mr-2"></i>Send Message
                        </button>
                        <button class="w-full flex items-center justify-center px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all">
                            <i class="fas fa-chart-line mr-2"></i>Generate Report
                        </button>
                    </div>
                </div>
            </div>

            <!-- Course Progress -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-800">Course Progress</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Progress</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Videos Watched</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for detail in study_details %}
                            <tr class="hover:bg-gray-50 transition-colors">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="font-medium text-gray-900">{{ detail.course_name }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-32 bg-gray-200 rounded-full h-2.5">
                                            <div class="bg-blue-600 h-2.5 rounded-full transition-all duration-500" 
                                                 style="width: {{ detail.progress }}%"></div>
                                        </div>
                                        <span class="text-sm font-medium text-gray-700 w-12">{{ detail.progress }}%</span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">{{ detail.watched_videos }}/{{ detail.total_videos }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                                        {% if detail.progress == 100 %}bg-green-100 text-green-800
                                        {% elif detail.progress >= 50 %}bg-blue-100 text-blue-800
                                        {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                        {% if detail.progress == 100 %}Completed
                                        {% elif detail.progress >= 50 %}In Progress
                                        {% else %}Not Started{% endif %}
                                    </span>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="px-6 py-4 text-center text-gray-500">
                                    <i class="fas fa-book-open text-4xl mb-3 opacity-50"></i>
                                    <p>No courses enrolled yet</p>
                                    <a href="{% url 'assign_courses' %}?student={{ student.id }}" class="text-blue-600 hover:text-blue-800 mt-2 inline-block">
                                        Assign courses to get started
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        function toggleProfileDropdown() {
            const dropdown = document.getElementById("profileDropdown");
            dropdown.classList.toggle("hidden");
        }

        // Close dropdown if clicked outside
        document.addEventListener("click", function(event) {
            const dropdown = document.getElementById("profileDropdown");
            const button = document.querySelector('[onclick="toggleProfileDropdown()"]');
            if (!dropdown.contains(event.target) && !button.contains(event.target)) {
                dropdown.classList.add("hidden");
            }
        });
    </script>
</body>
</html>