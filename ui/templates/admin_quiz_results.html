{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz Results | StudyPortal</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3f37c9;
      --success: #4cc9f0;
      --warning: #f72585;
      --light: #f8f9fa;
      --dark: #212529;
    }
    
    body {
      background: linear-gradient(135deg, #f5f7ff 0%, #f0f4ff 100%);
      font-family: 'Inter', sans-serif;
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
    }
    
    .sidebar-gradient {
      background: linear-gradient(180deg, #4361ee 0%, #3a0ca3 100%);
    }
    
    .gradient-text {
      background: linear-gradient(135deg, var(--primary), var(--success));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .hover-lift {
      transition: all 0.3s ease;
    }
    
    .hover-lift:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    }

    .chart-container {
      position: relative;
      height: 280px;
      width: 100%;
      min-height: 280px;
      flex:1;
    }
    
    .chart-grid > div {
      display: flex;
      flex-direction: column;
    }

    .chart-container {
      flex: 1;
      min-height: 280px;
    }

    canvas {
      display: block;
      max-width: 100%;
    }

    .chart-loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #6b7280;
    }

    .chart-wrapper {
      position: relative;
      width: 100%;
    }
  </style>
</head>

<body class="text-gray-800 antialiased">
<div class="flex min-h-screen">

  <!-- Sidebar -->
  <aside class="sidebar-gradient text-white w-64 fixed h-screen overflow-y-auto shadow-xl">
    <div class="p-6 border-b border-blue-400/30">
      <div class="flex items-center space-x-3">
        <div class="w-12 h-12 bg-white rounded-xl flex items-center justify-center shadow-lg">
          <i class="fas fa-graduation-cap text-blue-600 text-2xl"></i>
        </div>
        <div>
          <h2 class="text-xl font-bold">StudyPortal</h2>
          <p class="text-blue-200 text-xs">Admin Dashboard</p>
        </div>
      </div>
    </div>
    
    <nav class="flex-1 p-4 space-y-2">
      <a href="{% url 'admin_dashboard' %}" class="flex items-center space-x-3 p-3 text-blue-100 hover:bg-white/10 rounded-xl transition-all">
        <i class="fas fa-chart-line w-5 text-center"></i>
        <span>Dashboard</span>
      </a>
      <a href="{% url 'admin_students' %}" class="flex items-center space-x-3 p-3 text-blue-100 hover:bg-white/10 rounded-xl transition-all">
        <i class="fas fa-users w-5 text-center"></i>
        <span>Students</span>
      </a>
      <a href="{% url 'admin_courses' %}" class="flex items-center space-x-3 p-3 text-blue-100 hover:bg-white/10 rounded-xl transition-all">
        <i class="fas fa-book w-5 text-center"></i>
        <span>Courses</span>
      </a>
      
      <!-- MILESTONE 3 PROFESSIONAL FEATURES -->
      <a href="{% url 'assign_courses' %}" class="flex items-center space-x-3 p-3 text-blue-100 hover:bg-white/10 rounded-xl transition-all">
        <i class="fas fa-tasks w-5 text-center"></i>
        <span>Assign Courses</span>
      </a>
      <a href="{% url 'admin_quizzes' %}" class="flex items-center space-x-3 p-3 text-blue-100 hover:bg-white/10 rounded-xl transition-all">
        <i class="fas fa-question-circle w-5 text-center"></i>
        <span>Quiz Management</span>
      </a>
      <a href="{% url 'admin_quiz_results' %}" class="flex items-center space-x-3 p-3 bg-white/20 rounded-xl text-white font-medium">
        <i class="fas fa-chart-bar w-5 text-center"></i>
        <span>Quiz Results</span>
      </a>
      <a href="{% url 'student_study_tracks' %}" class="flex items-center space-x-3 p-3 text-blue-100 hover:bg-white/10 rounded-xl transition-all">
        <i class="fas fa-list-alt w-5 text-center"></i>
        <span>Study Tracks</span>
      </a>
      
      <a href="{% url 'admin_analytics' %}" class="flex items-center space-x-3 p-3 text-blue-100 hover:bg-white/10 rounded-xl transition-all">
        <i class="fas fa-chart-bar w-5 text-center"></i>
        <span>Analytics</span>
      </a>
    </nav>
    
    <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-blue-400/30">
      <div class="bg-white/10 rounded-lg p-3 text-center">
        <p class="text-blue-200 text-sm">StudyPortal Pro</p>
        <p class="text-blue-300 text-xs">v2.0</p>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="ml-64 p-8">

    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
      <div>
        <h1 class="text-4xl font-bold text-gray-900 mb-2">Quiz Results & Analytics</h1>
        <div class="flex items-center space-x-4 text-sm text-gray-600">
          <span class="flex items-center space-x-1">
            <i class="fas fa-calendar-day text-blue-500"></i>
            <span id="currentDate">{{ current_date }}</span>
          </span>
          <span class="flex items-center space-x-1">
            <i class="fas fa-clock text-green-500"></i>
            <span id="currentTime">{{ current_time }}</span>
          </span>
          <span class="flex items-center space-x-1">
            <i class="fas fa-user-shield text-purple-500"></i>
            <span>Administrator</span>
          </span>
        </div>
      </div>

      <!-- Profile Dropdown -->
      <div class="flex space-x-4">
        <a href="{% url 'admin_quizzes' %}" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-all">
          <i class="fas fa-arrow-left mr-2"></i>Back to Quizzes
        </a>
        <div class="relative">
          <button onclick="toggleProfileDropdown()" class="flex items-center space-x-3 bg-white px-4 py-2 rounded-xl shadow-lg border border-gray-200 hover:shadow-xl transition-all">
            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold">
              {{ user.username|first|upper }}
            </div>
            <div class="text-left">
              <p class="font-semibold text-gray-900">{{ user.username }}</p>
              <p class="text-xs text-gray-500">Administrator</p>
            </div>
            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
          </button>
          <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-64 bg-white border border-gray-200 rounded-xl shadow-2xl z-50">
            <div class="p-4 border-b">
              <p class="font-semibold text-gray-900">{{ user.username }}</p>
              <p class="text-sm text-gray-500">{{ user.email }}</p>
            </div>
            <div class="p-2">
              <a href="{% url 'admin_profile_settings' %}" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700">
                <i class="fas fa-user-cog text-blue-500 w-5"></i>
                <span>Profile Settings</span>
              </a>
            </div>
            <div class="p-2 border-t">
              <form method="post" action="{% url 'admin_logout' %}" class="w-full">{% csrf_token %}
                <button type="submit" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-red-50 text-red-600 w-full text-left">
                  <i class="fas fa-sign-out-alt w-5"></i>
                  <span>Logout</span>
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Messages Section -->
    {% if messages %}
    <div class="mb-6">
      {% for message in messages %}
      <div class="{% if message.tags == 'success' %}bg-green-50 border border-green-200 text-green-700{% else %}bg-red-50 border border-red-200 text-red-700{% endif %} rounded-lg p-4 mb-2">
        <div class="flex items-center">
          <i class="fas {% if message.tags == 'success' %}fa-check-circle{% else %}fa-exclamation-circle{% endif %} mr-2"></i>
          <span>{{ message }}</span>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Overall Statistics -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <!-- Total Quizzes -->
      <div class="glass-card p-6 rounded-2xl hover-lift group">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500 font-medium mb-1">Total Quizzes</p>
            <p class="text-3xl font-bold text-gray-900 mb-2">{{ total_quizzes }}</p>
            <div class="flex items-center text-sm text-blue-600">
              <i class="fas fa-list mr-1"></i>
              <span>Active quizzes</span>
            </div>
          </div>
          <div class="bg-blue-100 p-4 rounded-2xl group-hover:bg-blue-200 transition-colors">
            <i class="fas fa-list text-blue-600 text-2xl"></i>
          </div>
        </div>
      </div>

      <!-- Total Attempts -->
      <div class="glass-card p-6 rounded-2xl hover-lift group">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500 font-medium mb-1">Total Attempts</p>
            <p class="text-3xl font-bold text-gray-900 mb-2">{{ total_attempts_sum }}</p>
            <div class="flex items-center text-sm text-green-600">
              <i class="fas fa-check-circle mr-1"></i>
              <span>Completed attempts</span>
            </div>
          </div>
          <div class="bg-green-100 p-4 rounded-2xl group-hover:bg-green-200 transition-colors">
            <i class="fas fa-check-circle text-green-600 text-2xl"></i>
          </div>
        </div>
      </div>

      <!-- Average Pass Rate -->
      <div class="glass-card p-6 rounded-2xl hover-lift group">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500 font-medium mb-1">Avg. Pass Rate</p>
            <p class="text-3xl font-bold text-gray-900 mb-2">{{ avg_pass_rate }}%</p>
            <div class="flex items-center text-sm text-purple-600">
              <i class="fas fa-chart-line mr-1"></i>
              <span>Overall performance</span>
            </div>
          </div>
          <div class="bg-purple-100 p-4 rounded-2xl group-hover:bg-purple-200 transition-colors">
            <i class="fas fa-chart-line text-purple-600 text-2xl"></i>
          </div>
        </div>
      </div>

      <!-- Pending Attempts -->
      <div class="glass-card p-6 rounded-2xl hover-lift group">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500 font-medium mb-1">Pending Attempts</p>
            <p class="text-3xl font-bold text-gray-900 mb-2">{{ pending_students_sum }}</p>
            <div class="flex items-center text-sm text-orange-600">
              <i class="fas fa-clock mr-1"></i>
              <span>Awaiting completion</span>
            </div>
          </div>
          <div class="bg-orange-100 p-4 rounded-2xl group-hover:bg-orange-200 transition-colors">
            <i class="fas fa-clock text-orange-600 text-2xl"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 gap-8 mb-8">
      <!-- Quiz Results Table -->
      <div class="glass-card rounded-2xl p-6 shadow">
        <div class="flex justify-between items-center mb-6">
          <div>
            <h2 class="text-xl font-bold text-gray-900">Quiz Performance Overview</h2>
            <p class="text-gray-500 text-sm">Monitor quiz completion and student performance</p>
          </div>
          <div class="flex space-x-2">
            <button onclick="refreshData()" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors">
              <i class="fas fa-sync-alt mr-2"></i>Refresh
            </button>
          </div>
        </div>
        <div class="overflow-x-auto rounded-xl border border-gray-200">
          <table class="min-w-full">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Quiz Title</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Course</th>
                <th class="px-6 py-4 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider">Total Attempts</th>
                <th class="px-6 py-4 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider">Avg. Score</th>
                <th class="px-6 py-4 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider">Pass Rate</th>
                <th class="px-6 py-4 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider">Pending</th>
                
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              {% for stat in quiz_stats %}
              <tr class="hover:bg-gray-50 transition-colors">
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="font-medium text-gray-900">{{ stat.quiz.title }}</div>
                  <div class="text-sm text-gray-500">Due: {{ stat.quiz.due_date|date:"M d, Y" }}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="font-medium text-gray-900">{{ stat.quiz.course.course_name }}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    {{ stat.total_attempts }}
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                  <span class="{% if stat.avg_score >= 70 %}text-green-600{% elif stat.avg_score >= 50 %}text-yellow-600{% else %}text-red-600{% endif %}">
                    {{ stat.avg_score }}%
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {% if stat.pass_rate >= 70 %}bg-green-100 text-green-800{% elif stat.pass_rate >= 50 %}bg-yellow-100 text-yellow-800{% else %}bg-red-100 text-red-800{% endif %}">
                    {{ stat.pass_rate }}%
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                    {{ stat.pending_students }}
                  </span>
                </td>
                
              </tr>
              {% empty %}
              <tr>
                <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                  <i class="fas fa-chart-bar text-2xl mb-2"></i>
                  <p>No quiz results available</p>
                  <p class="text-sm mt-1">Create quizzes and students will start appearing here</p>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="mb-8">
      <div class="flex justify-between items-center mb-6">
        <div>
          <h2 class="text-2xl font-bold text-gray-900">Quiz Performance Analytics</h2>
          <p class="text-gray-500">Detailed insights into quiz completion and student performance</p>
        </div>
        <div class="flex space-x-2">
          <button onclick="toggleChartView()" id="chartViewToggle" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
            <i class="fas fa-chart-bar mr-2"></i>Detailed View
          </button>
        </div>
      </div>
      
      <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 chart-grid">
        <!-- Quiz Performance Chart -->
        <div class="glass-card rounded-2xl p-6 shadow hover-lift">
          <div class="flex justify-between items-center mb-4">
            <div>
              <h3 class="text-lg font-bold text-gray-900">Quiz Performance</h3>
              <p class="text-gray-500 text-sm">Average scores across all quizzes</p>
            </div>
            <div class="flex space-x-4">
              <div class="bg-blue-100 text-blue-700 px-3 py-2 rounded-lg">
                <p class="text-xs font-medium">Avg. Score</p>
                <p id="avgQuizScore" class="text-lg font-bold">{{ avg_pass_rate }}%</p>
              </div>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="quizPerformanceChart"></canvas>
          </div>
          <div class="mt-4 flex justify-between text-sm text-gray-500">
            <span>Top Quiz: <span id="topQuiz" class="font-medium text-gray-700">-</span></span>
            <span>Lowest Score: <span id="lowestScore" class="font-medium text-gray-700">0%</span></span>
          </div>
        </div>

        <!-- Completion Distribution -->
        <div class="glass-card rounded-2xl p-6 shadow hover-lift">
          <div class="flex justify-between items-center mb-4">
            <div>
              <h3 class="text-lg font-bold text-gray-900">Completion Distribution</h3>
              <p class="text-gray-500 text-sm">Quiz completion status overview</p>
            </div>
            <div class="flex space-x-4">
              <div class="bg-green-100 text-green-700 px-3 py-2 rounded-lg">
                <p class="text-xs font-medium">Completion</p>
                <p id="completionRate" class="text-lg font-bold">0%</p>
              </div>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="completionChart"></canvas>
          </div>
          <div class="mt-4 flex justify-between text-sm text-gray-500">
            <span>Completed: <span id="completedCount" class="font-medium text-gray-700">0</span></span>
            <span>Pending: <span id="pendingCount" class="font-medium text-gray-700">0</span></span>
          </div>
        </div>
      </div>
    </div>

  </main>
</div>

<script>
function toggleProfileDropdown() {
  const dropdown = document.getElementById("profileDropdown");
  dropdown.classList.toggle("hidden");
}

// Close dropdown when clicking outside
document.addEventListener("click", function(event) {
  const dropdown = document.getElementById("profileDropdown");
  const button = document.querySelector('[onclick="toggleProfileDropdown()"]');
  if (dropdown && button && !dropdown.contains(event.target) && !button.contains(event.target)) {
    dropdown.classList.add("hidden");
  }
});

// Update current time
function updateDateTime() {
  const now = new Date();
  document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', { 
    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
  });
  document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', {
    hour: '2-digit', minute: '2-digit'
  });
}

setInterval(updateDateTime, 1000);
updateDateTime();

// Global chart instances
let quizPerformanceChartInstance = null;
let completionChartInstance = null;

// Create charts with quiz data
function createQuizCharts() {
  // Destroy existing charts if they exist
  if (quizPerformanceChartInstance) {
    quizPerformanceChartInstance.destroy();
  }
  if (completionChartInstance) {
    completionChartInstance.destroy();
  }

  // Quiz Performance Chart
  const quizCtx = document.getElementById('quizPerformanceChart').getContext('2d');
  
  // Sample data - replace with actual data from your backend
  const quizLabels = [
    {% for stat in quiz_stats %}
      "{{ stat.quiz.title|truncatechars:15 }}",
    {% endfor %}
  ];
  
  const quizScores = [
    {% for stat in quiz_stats %}
      {{ stat.avg_score }},
    {% endfor %}
  ];

  quizPerformanceChartInstance = new Chart(quizCtx, {
    type: 'bar',
    data: {
      labels: quizLabels,
      datasets: [{
        label: 'Average Score (%)',
        data: quizScores,
        backgroundColor: 'rgba(67, 97, 238, 0.7)',
        borderColor: 'rgba(67, 97, 238, 1)',
        borderWidth: 1,
        borderRadius: 8,
        barPercentage: 0.6
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: { 
          beginAtZero: true,
          max: 100,
          grid: { color: 'rgba(0,0,0,0.1)' },
          ticks: { font: { size: 11 } }
        },
        x: { 
          grid: { display: false },
          ticks: { font: { size: 11 } }
        }
      },
      plugins: {
        legend: { display: false },
        tooltip: { 
          backgroundColor: 'rgba(255,255,255,0.9)',
          titleColor: '#1f2937',
          bodyColor: '#1f2937',
          borderColor: 'rgba(0,0,0,0.1)',
          borderWidth: 1
        }
      }
    }
  });

  // Completion Distribution Chart
  const completionCtx = document.getElementById('completionChart').getContext('2d');
  
  // Calculate completion data
  const totalAttempts = {{ total_attempts_sum }};
  const pendingAttempts = {{ pending_students_sum }};
  const completedAttempts = totalAttempts - pendingAttempts;
  
  completionChartInstance = new Chart(completionCtx, {
    type: 'doughnut',
    data: {
      labels: ['Completed', 'Pending'],
      datasets: [{
        data: [completedAttempts, pendingAttempts],
        backgroundColor: [
          'rgba(34, 197, 94, 0.8)',
          'rgba(249, 115, 22, 0.8)'
        ],
        borderWidth: 2,
        borderColor: '#fff'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '65%',
      plugins: {
        legend: {
          position: 'bottom',
          labels: { font: { size: 11 }, padding: 15 }
        }
      }
    }
  });

  // Update chart statistics
  document.getElementById("completionRate").innerText = totalAttempts > 0 ? 
    Math.round((completedAttempts / totalAttempts) * 100) + '%' : '0%';
  document.getElementById("completedCount").innerText = completedAttempts;
  document.getElementById("pendingCount").innerText = pendingAttempts;
  
  // Find top quiz and lowest score
  if (quizScores.length > 0) {
    const maxScore = Math.max(...quizScores);
    const minScore = Math.min(...quizScores);
    const topQuizIndex = quizScores.indexOf(maxScore);
    
    document.getElementById("topQuiz").innerText = quizLabels[topQuizIndex] || '-';
    document.getElementById("lowestScore").innerText = minScore + '%';
  }
}

// Create empty charts when no data is available
function createEmptyQuizCharts() {
  // Destroy existing charts
  if (quizPerformanceChartInstance) {
    quizPerformanceChartInstance.destroy();
  }
  if (completionChartInstance) {
    completionChartInstance.destroy();
  }

  // Create empty quiz performance chart
  const quizCtx = document.getElementById('quizPerformanceChart').getContext('2d');
  quizPerformanceChartInstance = new Chart(quizCtx, {
    type: 'bar',
    data: {
      labels: ['No Data'],
      datasets: [{
        label: 'Average Score',
        data: [0],
        backgroundColor: 'rgba(156, 163, 175, 0.7)',
        borderColor: 'rgba(156, 163, 175, 1)',
        borderWidth: 1,
        borderRadius: 8
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: { beginAtZero: true }
      },
      plugins: {
        legend: { display: false }
      }
    }
  });

  // Create empty completion chart
  const completionCtx = document.getElementById('completionChart').getContext('2d');
  completionChartInstance = new Chart(completionCtx, {
    type: 'doughnut',
    data: {
      labels: ['No Data'],
      datasets: [{
        data: [1],
        backgroundColor: ['rgba(156, 163, 175, 0.8)'],
        borderWidth: 2,
        borderColor: '#fff'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '65%',
      plugins: {
        legend: { display: false }
      }
    }
  });
}

// Refresh data function
function refreshData() {
  const refreshBtn = document.querySelector('button[onclick="refreshData()"]');
  const originalHtml = refreshBtn.innerHTML;
  refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Refreshing...';
  refreshBtn.disabled = true;

  // In a real implementation, you would fetch updated data here
  // For now, we'll just reload the page
  setTimeout(() => {
    window.location.reload();
  }, 1000);
}

// Toggle chart view between simple and detailed
function toggleChartView() {
  const toggleBtn = document.getElementById('chartViewToggle');
  const chartGrid = document.querySelector('.chart-grid');
  
  if (toggleBtn.innerHTML.includes('Detailed View')) {
    // Switch to detailed view
    toggleBtn.innerHTML = '<i class="fas fa-chart-simple mr-2"></i>Simple View';
    chartGrid.classList.add('detailed-view');
    
    // Increase chart height for detailed view
    document.querySelectorAll('.chart-container').forEach(container => {
      container.style.height = '380px';
    });
    
    // Update chart options for detailed view
    if (quizPerformanceChartInstance) {
      quizPerformanceChartInstance.options.plugins.legend.display = true;
      quizPerformanceChartInstance.update();
    }
  } else {
    // Switch to simple view
    toggleBtn.innerHTML = '<i class="fas fa-chart-bar mr-2"></i>Detailed View';
    chartGrid.classList.remove('detailed-view');
    
    // Reset chart height
    document.querySelectorAll('.chart-container').forEach(container => {
      container.style.height = '280px';
    });
    
    // Update chart options for simple view
    if (quizPerformanceChartInstance) {
      quizPerformanceChartInstance.options.plugins.legend.display = false;
      quizPerformanceChartInstance.update();
    }
  }
}

// Load data when page loads
document.addEventListener("DOMContentLoaded", function () {
  createQuizCharts();
});
</script>
</body>
</html>